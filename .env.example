# ==============
# Core Settings
# ==============
APP_ENV=development  # development, staging, production
APP_NAME=magflow
APP_PORT=8010
APP_DEBUG=true
APP_SECRET=change_me_to_a_secure_secret
APP_VERSION=0.1.0
COMPOSE_PROJECT_NAME=magflow

# ==============
# API Settings
# ==============
API_PREFIX=/api/v1
CORS_ORIGINS=["http://localhost:3000", "http://127.0.0.1:3000"]

# ==============
# JWT Authentication
# ==============
JWT_ALGORITHM=RS256
JWT_ISSUER=magflow-service
JWT_AUDIENCE=magflow-api
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=15
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7
JWT_LEEWAY=60  # seconds
JWT_KEY_EXPIRE_DAYS=30
JWT_ROTATE_DAYS=7
JWT_MAX_ACTIVE_KEYS=2
JWKS_CACHE_MAX_AGE=3600

# ==============
# Database (Direct)
# ==============
DB_HOST=postgres
DB_PORT=5432
DB_NAME=magflow
DB_USER=app
DB_PASS=app_password_change_me
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=10
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600
DB_ECHO=false
SEARCH_PATH=app,public
# Override settings for local sync utilities
EMAG_SYNC_DB_HOST_OVERRIDE=
EMAG_SYNC_LOCAL_DB_HOST=127.0.0.1
EMAG_SYNC_DISABLE_HOST_AUTO_OVERRIDE=false

# ==============
# PgBouncer
# ==============
PGBOUNCER_HOST=pgbouncer
PGBOUNCER_PORT=6432
PGBOUNCER_POOL_MODE=transaction

# ==============
# Sentry Configuration
# ==============
# Get your DSN from Sentry.io project settings
# SENTRY_DSN=https://example@sentry.io/1234567

# Sample rates (0.0 to 1.0)
SENTRY_SAMPLE_RATE=1.0
SENTRY_TRACES_SAMPLE_RATE=0.5
SENTRY_PROFILES_SAMPLE_RATE=0.1
PGBOUNCER_MAX_CLIENT_CONN=100
PGBOUNCER_DEFAULT_POOL_SIZE=20

# ==============
# Health Check
# ==============
# Health check timeout in seconds
HEALTH_CHECK_TIMEOUT=5

# ==============
# JWKS Settings
# ==============
# URL to fetch JSON Web Key Set (JWKS) from
JWKS_URL=http://app:8000/.well-known/jwks.json
# Minimum number of keys expected in JWKS
JWKS_MIN_KEYS=1
# Timeout for JWKS fetch in seconds
JWKS_TIMEOUT=5

# ==============
# Redis
# ==============
REDIS_URL=redis://redis:6379/0
REDIS_PASSWORD=redis_password_change_me
REDIS_TIMEOUT=5
REDIS_SOCKET_TIMEOUT=5
REDIS_SOCKET_CONNECT_TIMEOUT=5
REDIS_RETRY_ON_TIMEOUT=true

# ==============
# Celery (Background Tasks)
# ==============
CELERY_BROKER_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
CELERY_RESULT_BACKEND=redis://:${REDIS_PASSWORD}@redis:6379/0

# ==============
# Cache
# ==============
CACHE_DEFAULT_TIMEOUT=300  # 5 minutes
CACHE_KEY_PREFIX=magflow_cache
CACHE_REDIS_URL=${REDIS_URL}/1

# ==============
# Rate Limiting
# ==============
RATE_LIMIT=1000/hour
RATE_LIMIT_AUTH=5000/hour
RATE_LIMIT_IP=100/hour

# ==============
# Observability
# ==============
# OTEL_SERVICE_NAME=magflow
# OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector:4317
# OTEL_PYTHON_LOG_CORRELATION=true

# ==============
# Monitoring (Optional)
# =================
# SENTRY_DSN=
# DATADOG_TRACER_ENABLED=false
# DATADOG_AGENT_HOST=datadog-agent
GRAFANA_ADMIN_PASSWORD=change_me

# ==============
# Feature Flags
# ==============
FEATURE_CACHE_ENABLED=true
FEATURE_RATE_LIMITING=true
FEATURE_MAINTENANCE_MODE=false

# ==============
# Security
# ==============
SECURE_COOKIES=true
SECURE_HEADERS=true
CONTENT_SECURITY_POLICY=default-src 'self'

# ==============
# External Services
# ==============
# EMAIL_PROVIDER=console  # console, sendgrid, ses
# SENDGRID_API_KEY=
# AWS_ACCESS_KEY_ID=
# AWS_SECRET_ACCESS_KEY=
# AWS_REGION=

# ==============
# eMAG Integration
# ==============
# Main account credentials (Marketplace main flow)
EMAG_MAIN_USERNAME=
EMAG_MAIN_PASSWORD=
# FBE account credentials (Fulfilled by eMAG flow)
EMAG_FBE_USERNAME=
EMAG_FBE_PASSWORD=
# API endpoints and settings (optional overrides)
EMAG_API_BASE_URL=https://marketplace-api.emag.ro/api-3
EMAG_API_TIMEOUT=30

# ==============
# Development Only
# ==============
if [ "$APP_ENV" = "development" ]; then
    PYTHONUNBUFFERED=1
    PYTHONFAULTHANDLER=1
    PYTHONHASHSEED=0
    PYTHONDONTWRITEBYTECODE=1
    PYTHONASYNCIODEBUG=1
    DEBUG_TOOLBAR_ENABLED=true
fi
