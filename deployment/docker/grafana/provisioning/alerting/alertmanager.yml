apiVersion: 1

# Global settings for all alerts
global:
  resolve_timeout: 5m
  smtp_smarthost: '${SMTP_HOST:-smtp.example.com}:${SMTP_PORT:-587}'
  smtp_from: '${SMTP_FROM:-alerts@magflow.example.com}'
  smtp_auth_username: '${SMTP_USER}'
  smtp_auth_password: '${SMTP_PASSWORD}'
  smtp_require_tls: true

# Alert manager configuration
alertmanager_config: |
  global:
    smtp_smarthost: '${SMTP_HOST:-smtp.example.com}:${SMTP_PORT:-587}'
    smtp_from: '${SMTP_FROM:-alerts@magflow.example.com}'
    smtp_auth_username: '${SMTP_USER}'
    smtp_auth_password: '${SMTP_PASSWORD}'
    smtp_require_tls: true

  route:
    group_by: ['alertname', 'severity']
    group_wait: 30s
    group_interval: 5m
    repeat_interval: 4h
    receiver: 'team-email'

  receivers:
  - name: 'team-email'
    email_configs:
    - to: 'devops@magflow.example.com'
      send_resolved: true
      headers:
        subject: '[{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}] {{ .CommonLabels.alertname }}'
      html: '{{ template "email.default.html" . }}'
